var Input={mouseDown:!1,mousePos:{x:0,y:0},lastPos:{x:0,y:0},getMousePos:function(a){return{x:a.clientX,y:a.clientY}}};var Util={randomNames:null,getNameList:function(a){var b=new XMLHttpRequest,c=this;b.open("GET","/files/names.txt",!0);b.onreadystatechange=function(){4===b.readyState&&200===b.status&&(allText=b.responseText,lines=b.responseText.split("\n"),c.randomNames=lines,a())};b.send(null)},pickRandomName:function(){var a=Math.floor(Math.random()*this.randomNames.length);return this.randomNames[a]},isMouseOnCanvas:function(a){var b=Input.mousePos;canvasRect=a.getBoundingClientRect();return b.x>=canvasRect.left&&
b.x<=canvasRect.right&&b.y>=canvasRect.top&&b.y<=canvasRect.bottom?!0:!1},getColourOnCanvas:function(a,b){var c=a.getBoundingClientRect(),c=b.getImageData(Input.mousePos.x-c.left,Input.mousePos.y-c.top,1,1).data;return{r:c[0],g:c[1],b:c[2],a:c[3]}},rgbToHex:function(a){return"#"+(16777216+(a.r<<16)+(a.g<<8)+a.b).toString(16).slice(1)},hexToRgb:function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},hsvToRgb:function(a,
b,c){var d,e,f,g,k,h,l;1===arguments.length&&(b=a.s,c=a.v,a=a.h);g=Math.floor(6*a);k=6*a-g;h=c*(1-b);l=c*(1-k*b);k=c*(1-(1-k)*b);switch(g%6){case 0:d=c;e=k;f=h;break;case 1:d=l;e=c;f=h;break;case 2:d=h;e=c;f=k;break;case 3:d=h;e=l;f=c;break;case 4:d=k;e=h;f=c;break;case 5:d=c,e=h,f=l}return new Colour(Math.round(255*d),Math.round(255*e),Math.round(255*f))},rgbToHsv:function(a,b,c){var d,e;a/=255;b/=255;var f=c/255,g,k,h=Math.max(a,b,f);e=h-Math.min(a,b,f);0==e?g=k=0:(k=e/h,c=(h-a)/6/e+.5,d=(h-b)/
6/e+.5,e=(h-f)/6/e+.5,a===h?g=e-d:b===h?g=1/3+c-e:f===h&&(g=2/3+d-c),0>g?g+=1:1<g&&--g);return{h:Math.round(360*g),s:Math.round(100*k),v:Math.round(100*h)}}};function selectElement(a){document.getElementById(a.id+"-radio").checked=!0;for(var b=document.getElementById("rooms").rows,c=1;c<b.length;c++)b[c].className="";a.className="row-selected"}var selectedRoom;
function selectACPElement(a){document.getElementById(a.id+"-radio").checked=!0;for(var b=document.getElementById("rooms").rows,c=0;c<b.length;c++)b[c].className="";a.className="row-selected";selectedRoom=a.id;b=document.getElementById("room-users");for(c=1;c<b.rows.length;c++)b.rows[c].className=b.rows[c].id===a.id?"":"Invisible"}function redirectToRoom(){null==selectedRoom&&(selectedRoom=document.getElementById("rooms").rows[1].id);location.href=getBaseURL()+"/rooms/"+selectedRoom}
function searchRoom(){for(var a=document.getElementById("rooms").getElementsByTagName("tbody")[0].rows,b=document.getElementById("room-search"),c=0;c<a.length;c++)a[c].className="",""!=b.value&&-1==a[c].cells[0].innerHTML.indexOf(b.value)&&(a[c].className="invisible")}function joinRoom(){for(var a=document.getElementsByName("rooms"),b="",c=0;c<a.length;c++)if(a[c].checked){b=a[c].id;break}a=b.split("-");document.location.href=getBaseURL()+"/rooms/"+a[0]}
function getBaseURL(){var a=document.location.href.split("/");return a[0]+"//"+a[2]};var ToolSet=function(){this.brush=new Brush;this.textTool=new TextTool;this.shapeTool=new ShapeTool;this.dropper=new Dropper};ToolSet.prototype.getBrushType=function(){return this.brush.getBrushType()};
ToolSet.prototype.updateGradientBrush=function(){255<=this.brush.gradientTimer?this.brush.gradientSwitch=!0:0>=this.brush.gradientTimer&&(this.brush.gradientSwitch=!1);this.brush.gradientTimer=!0===this.brush.gradientSwitch?this.brush.gradientTimer-this.brush.gradientSpeed:this.brush.gradientTimer+this.brush.gradientSpeed};ToolSet.prototype.updateRainbowBrush=function(){this.brush.rainbowPointer+=this.brush.rainbowSpeed;255<=this.brush.rainbowPointer&&(this.brush.rainbowPointer=0)};
var ToolTypes={FREE_ROAM:"freeroam",GRADIENT_BRUSH:"gradient-brush",RAINBOW_BRUSH:"rainbow-brush",DROPPER:"dropper",ERASER:"eraser",SQUARE_BRUSH:"square-brush",TEXT_TOOL:"text",SHAPE_TOOL:"shape",LINE_TOOL:"line"};var Brush=function(){this.size=30;this.colour="#ff0000";this.brushType="freeroam";this.lineTip="round";this.gradientTimer=0;this.gradientSpeed=1;this.gradientSwitch=!1;this.rainbowPointer=0;this.rainbowSpeed=1};Brush.prototype.setBrushType=function(a){this.brushType=a};Brush.prototype.getBrushType=function(){return this.brushType};Brush.prototype.setBrushSize=function(a){this.size=a};Brush.prototype.getBrushSize=function(){return this.size};Brush.prototype.setColour=function(a){this.colour=a};
Brush.prototype.drawBrushOutline=function(a,b){var c=pointerCanvas.getBoundingClientRect(),d=this.size/2;1.5>=d&&(d=1.5);pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.lineWidth=1;pointerContext.lineCap="round";pointerContext.beginPath();pointerContext.strokeStyle="white";pointerContext.arc(a-c.left,b-c.top,Math.abs(d+1),0,2*Math.PI);pointerContext.stroke();pointerContext.beginPath();pointerContext.strokeStyle="black";pointerContext.arc(a-c.left,b-c.top,Math.abs(d),
0,2*Math.PI);pointerContext.stroke();pointerContext.beginPath();pointerContext.strokeStyle="white";pointerContext.arc(a-c.left,b-c.top,Math.abs(d-1),0,2*Math.PI);pointerContext.stroke()};
Brush.prototype.drawEraserOutline=function(a,b){var c=pointerCanvas.getBoundingClientRect(),d=this.size/2;1.5>=d&&(d=1.5);pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.lineWidth=1;pointerContext.lineCap="round";pointerContext.beginPath();pointerContext.rect(a-c.left-d-1,b-c.top-d-1,2*d+2,2*d+2);pointerContext.strokeStyle="white";pointerContext.stroke();pointerContext.beginPath();pointerContext.rect(a-c.left-d,b-c.top-d,2*d,2*d);pointerContext.strokeStyle="black";
pointerContext.stroke();pointerContext.beginPath();pointerContext.rect(a-c.left-d+1,b-c.top-d+1,2*d-2,2*d-2);pointerContext.strokeStyle="white";pointerContext.stroke()};
Brush.prototype.gradientDraw=function(){canvasRect=canvas.getBoundingClientRect();var a=Util.hexToRgb(tool.brush.colour);a.r-=this.gradientTimer;a.g-=this.gradientTimer;a.b-=this.gradientTimer;0>=a.r&&(a.r=0);0>=a.g&&(a.g=0);0>=a.b&&(a.b=0);a=Util.rgbToHex(a);a={name:client.name,x:Input.mousePos.x-canvasRect.left,y:Input.mousePos.y-canvasRect.top,lastX:Input.lastPos.x-canvasRect.left,lastY:Input.lastPos.y-canvasRect.top,size:tool.brush.size,colour:a};tool.shapeTool.drawCircle(a.x,a.y,a.lastX,a.lastY,
a.size,a.colour);socket.emit("draw",a)};
Brush.prototype.rainbowDraw=function(){canvasRect=canvas.getBoundingClientRect();var a=Util.hexToRgb(tool.brush.colour);ColourPicker.huePosition=new Position(0,this.rainbowPointer);a=ColourPicker.getColourOnHueCanvas(ColourPicker.getHueContext(),ColourPicker.huePosition);a=Util.rgbToHex(a);a={name:client.name,x:Input.mousePos.x-canvasRect.left,y:Input.mousePos.y-canvasRect.top,lastX:Input.lastPos.x-canvasRect.left,lastY:Input.lastPos.y-canvasRect.top,size:this.size,colour:a};tool.shapeTool.drawCircle(a.x,
a.y,a.lastX,a.lastY,a.size,a.colour);socket.emit("draw",a)};Brush.prototype.drawTempLine=function(a,b,c,d,e,f,g){g=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.strokeStyle=e;pointerContext.lineWidth=f;pointerContext.lineCap=tool.brush.lineTip;pointerContext.beginPath();pointerContext.moveTo(a-g.left,b-g.top);pointerContext.lineTo(c-g.left,d-g.top);pointerContext.stroke()};
Brush.prototype.drawShapeLine=function(a,b,c,d,e,f,g){context.strokeStyle=e;context.lineWidth=f;context.lineCap=tool.brush.lineTip;context.beginPath();context.moveTo(a,b);context.lineTo(c,d);context.stroke()};
Brush.prototype.draw=function(){canvasRect=canvas.getBoundingClientRect();var a={name:client.name,x:Input.mousePos.x-canvasRect.left,y:Input.mousePos.y-canvasRect.top,lastX:Input.lastPos.x-canvasRect.left,lastY:Input.lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawCircle(a.x,a.y,a.lastX,a.lastY,a.size,a.colour);socket.emit("draw",a)};
Brush.prototype.erase=function(){canvasRect=canvas.getBoundingClientRect();var a={name:client.name,x:Input.mousePos.x-canvasRect.left,y:Input.mousePos.y-canvasRect.top,lastX:Input.lastPos.x-canvasRect.left,lastY:Input.lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawRect(a.x,a.y,a.lastX,a.lastY,a.size,"white");socket.emit("erase",a)};
Brush.prototype.drawSquare=function(){canvasRect=canvas.getBoundingClientRect();var a={name:client.name,x:Input.mousePos.x-canvasRect.left,y:Input.mousePos.y-canvasRect.top,lastX:Input.lastPos.x-canvasRect.left,lastY:Input.lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawRect(a.x,a.y,a.lastX,a.lastY,a.size,a.colour);socket.emit("draw square",a)};var TextTool=function(){this.textToRender="";this.textFont="20px Arial";this.ready=!1;this.textPos={x:0,y:0}};TextTool.prototype.drawText=function(a,b,c,d,e){context.font=c;context.fillStyle=d;context.fillText(e,a,b)};TextTool.prototype.drawTempText=function(a,b,c,d,e){var f=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.font=c;pointerContext.fillStyle=d;pointerContext.fillText(e,a-f.left,b-f.top)};
TextTool.prototype.changeFont=function(){var a=document.getElementById("fontSel"),a=a.options[a.selectedIndex].value;this.textFont=tool.textTool.textFont.split(" ")[0]+" "+a;this.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)};
TextTool.prototype.changeTextSize=function(a){var b=document.getElementById("fontSel");this.textFont=a+"px "+b.options[b.selectedIndex].value;this.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)};var ShapeTool=function(){this.shapeType="rectangle";this.readyToDraw=this.sizingReady=!1;this.shapePos={x:0,y:0};this.shapeEndPos={x:0,y:0}};ShapeTool.prototype.getShapeType=function(){return this.shapeType};ShapeTool.prototype.setShapeType=function(a,b){a.className="button bselect tool";this.shapeType=b};
ShapeTool.prototype.drawRect=function(a,b,c,d,e,f){c={x:c,y:d};b={x:a,y:b};a=distanceBetween(c,b);b=angleBetween(c,b);for(d=0;d<a;d+=1)x=c.x+Math.sin(b)*d,y=c.y+Math.cos(b)*d,context.fillStyle=f,context.fillRect(x-e/2,y-e/2,e,e)};ShapeTool.prototype.drawTempRect=function(a,b,c,d){var e=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.fillStyle=tool.brush.colour;pointerContext.fillRect(a-e.left,b-e.top,c-a,d-b)};
ShapeTool.prototype.drawShapeRect=function(a,b,c,d,e){context.fillStyle=e;context.fillRect(a,b,c-a,d-b)};ShapeTool.prototype.drawCircle=function(a,b,c,d,e,f){c={x:c,y:d};b={x:a,y:b};a=distanceBetween(c,b);b=angleBetween(c,b);for(d=0;d<a;d+=1)x=c.x+Math.sin(b)*d,y=c.y+Math.cos(b)*d,context.beginPath(),context.fillStyle=f,context.arc(x,y,e/2,!1,2*Math.PI,!1),context.closePath(),context.fill()};
ShapeTool.prototype.drawTempCircle=function(a,b,c,d,e){var f=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);pointerContext.beginPath();var g=0,g=Math.abs(c-a)>Math.abs(d-b)?Math.abs(c-a):Math.abs(d-b);pointerContext.arc(a-f.left,b-f.top,g,0,2*Math.PI,!1);pointerContext.fillStyle=e;pointerContext.fill()};
ShapeTool.prototype.drawShapeCircle=function(a,b,c,d,e){context.beginPath();var f=0,f=Math.abs(c-a)>Math.abs(d-b)?Math.abs(c-a):Math.abs(d-b);context.arc(a,b,f,0,2*Math.PI,!1);context.fillStyle=e;context.fill()};
ShapeTool.prototype.drawTempRegularPolygon=function(a,b,c,d,e,f){var g=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);var k=0,k=Math.abs(d-b)>Math.abs(e-c)?Math.abs(d-b):Math.abs(e-c);pointerContext.fillStyle=f;pointerContext.beginPath();for(d=0;d<a;d++)pointerContext.lineTo(b-g.left-Math.sin(d/a*2*Math.PI)*k,c-g.top-Math.cos(d/a*2*Math.PI)*k);pointerContext.closePath();pointerContext.fill()};
ShapeTool.prototype.drawShapeRegularPolygon=function(a,b,c,d,e,f){var g=0,g=Math.abs(d-b)>Math.abs(e-c)?Math.abs(d-b):Math.abs(e-c);context.fillStyle=f;context.beginPath();for(d=0;d<a;d++)context.lineTo(b-Math.sin(d/a*2*Math.PI)*g,c-Math.cos(d/a*2*Math.PI)*g);context.closePath();context.fill()};
ShapeTool.prototype.drawTemp=function(){switch(this.getShapeType()){case ShapeTypes.RECTANGLE:this.drawTempRect(this.shapePos.x,this.shapePos.y,this.shapeEndPos.x,this.shapeEndPos.y,tool.brush.colour);break;case ShapeTypes.CIRCLE:this.drawTempCircle(this.shapePos.x,this.shapePos.y,this.shapeEndPos.x,this.shapeEndPos.y,tool.brush.colour);break;case ShapeTypes.PENTAGON:this.drawTempRegularPolygon(5,this.shapePos.x,this.shapePos.y,this.shapeEndPos.x,this.shapeEndPos.y,tool.brush.colour);break;case ShapeTypes.HEXAGON:this.drawTempRegularPolygon(6,
this.shapePos.x,this.shapePos.y,this.shapeEndPos.x,this.shapeEndPos.y,tool.brush.colour)}};
ShapeTool.prototype.draw=function(a){switch(this.getShapeType()){case ShapeTypes.RECTANGLE:this.drawShapeRect(a.x,a.y,a.endX,a.endY,a.colour);socket.emit("draw rect",a);break;case ShapeTypes.CIRCLE:this.drawShapeCircle(a.x,a.y,a.endX,a.endY,a.colour);socket.emit("draw circle",a);break;case ShapeTypes.PENTAGON:this.drawShapeRegularPolygon(5,a.x,a.y,a.endX,a.endY,a.colour);socket.emit("draw pentagon",a);break;case ShapeTypes.HEXAGON:this.drawShapeRegularPolygon(6,a.x,a.y,a.endX,a.endY,a.colour),socket.emit("draw hexagon",
a)}this.sizingReady=!1};var ShapeTypes={RECTANGLE:"rectangle",CIRCLE:"circle",PENTAGON:"pentagon",HEXAGON:"hexagon"};var Dropper=function(){};Dropper.prototype.onColourChange=function(a){var b=Util.rgbToHex(a);a=Util.rgbToHsv(a.r,a.g,a.b);ColourPicker.tintPosition=new Position(Math.ceil(2.55*(100-a.s)),Math.ceil(2.55*(100-a.v)));ColourPicker.huePosition=new Position(0,Math.ceil((360-a.h)/360*255));ColourPicker.updateColour();tool.brush.setColour(b)};Dropper.prototype.updateColour=function(){if(Util.isMouseOnCanvas(canvas)){var a=Util.getColourOnCanvas(canvas,context);this.onColourChange(a)}};var socket=io.connect(),canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),pointerCanvas=document.getElementById("pointer-canvas"),pointerContext=pointerCanvas.getContext("2d"),tool=new ToolSet,client={name:null,hasSynced:!1,canDraw:!1,currentlyVoting:!1,currentlySaving:!1,messageCounter:0,userJoinCounter:0};function getConnectedUsers(){return document.getElementById("users").children.length}
function loadCanvasPage(){var a=document.getElementById("room-id").innerHTML;socket.emit("does room exist",a)}function sendChatMessage(){var a={name:client.name,message:document.getElementById("chat-message").value};0<a.message.length&&(document.getElementById("chat-message").value="",addChatMessage(a),socket.emit("chat message",a))}document.getElementById("chat-message").onkeypress=function(a){a||(a=window.event);if("13"==(a.keyCode||a.which))return sendChatMessage(),!1};
document.getElementById("name").onkeypress=function(a){a||(a=window.event);if("13"==(a.keyCode||a.which))return sync(),!1};function init(){context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);ColourPicker.initColourPicker();Util.getNameList(function(){var a=Util.pickRandomName();document.getElementById("name").value=a;client.name=a})}
function sync(){if(!1===client.hasSynced){var a=document.getElementById("room-id").innerHTML;client.name=document.getElementById("name").value;var b={id:a,name:client.name,colour:tool.brush.colour};socket.emit("join room",a);socket.emit("im online",b)}}
socket.on("does room exist result",function(a){1==a?(document.getElementById("name-box").className="",document.getElementById("name-content").className=""):(document.getElementById("name-box").className="",document.getElementById("room-not-exist").className="",document.getElementById("name-content").className="Invisible")});
socket.on("room does not exist",function(a){document.getElementById("name-box").className="";document.getElementById("room-not-exist").className="";document.getElementById("name-content").className="Invisible"});socket.on("name taken",function(){document.getElementById("name-taken").className=""});
socket.on("user validated",function(){document.getElementById("name-content").className="invisible";document.getElementById("name-taken").className="invisible";document.getElementById("currently-syncing").className="";socket.emit("sync")});socket.on("room full",function(){document.getElementById("room-full").className=""});socket.on("sync draw",function(a){tool.shapeTool.drawCircle(a.x,a.y,a.lastX,a.lastY,a.size,a.colour)});
socket.on("sync draw text",function(a){tool.textTool.drawText(a.x,a.y,a.font,a.colour,a.text)});socket.on("sync draw rect",function(a){tool.shapeTool.drawShapeRect(a.x,a.y,a.endX,a.endY,a.colour)});socket.on("sync draw circle",function(a){tool.shapeTool.drawShapeCircle(a.x,a.y,a.endX,a.endY,a.colour)});socket.on("sync draw pentagon",function(a){tool.shapeTool.drawShapeRegularPolygon(5,a.x,a.y,a.endX,a.endY,a.colour)});
socket.on("sync draw hexagon",function(a){tool.shapeTool.drawShapeRegularPolygon(6,a.x,a.y,a.endX,a.endY,a.colour)});socket.on("sync draw line",function(a){tool.brush.drawShapeLine(a.x,a.y,a.endX,a.endY,a.colour,a.size,a.lineTip)});socket.on("sync erase",function(a){tool.shapeTool.drawRect(a.x,a.y,a.lastX,a.lastY,a.size,"white")});socket.on("sync draw square",function(a){tool.shapeTool.drawRect(a.x,a.y,a.lastX,a.lastY,a.size,a.colour)});
socket.on("sync result",function(a){document.getElementById("name-wrap").className="invisible";if(null!=a){var b=new Image;b.onload=function(){context.drawImage(b,0,0)};b.src=a}client.hasSynced=!0});socket.on("send canvas",function(){socket.emit("receive canvas",canvas.toDataURL())});
socket.on("user list",function(a){clearUsers();if(0!=a.length){for(var b=0;b<a.length;b++)null!=a[b]&&(a[b].name==name?addUser(a[b].name+" (you)",a[b].colour):addUser(a[b].name,a[b].colour));a=document.getElementById("users-online-tab");"tab selected"!=a.className?(client.userJoinCounter++,a.innerHTML='<a>Users Online</a><div class="orange-notification">'+client.userJoinCounter+"</div>"):client.userJoinCounter=0}});
socket.on("sync user colour",function(a){if(0!=a.length)for(var b=0;b<a.length;b++){var c;a[b].name===name?(c=document.getElementById(a[b].name+" (you)"),null!=c&&(c.innerHTML='<div class="user-colour" style="background-color:'+a[b].colour+'"></div><div class="user-name">'+a[b].name+" (you)</div>")):(c=document.getElementById(a[b].name),null!=c&&(c.innerHTML='<div class="user-colour" style="background-color:'+a[b].colour+'"></div><div class="user-name">'+a[b].name+"</div>"))}});
socket.on("receive clear canvas",function(){context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height)});socket.on("send vote clear",function(a){client.currentlyVoting=!0;document.getElementById("clear-canvas-vote-box").className="";document.getElementById("timeRemain").innerHTML=a});
socket.on("send clear vote timer",function(a){document.getElementById("clear-canvas-vote-box").className="";document.getElementById("clear-wrap").className="table-visible";document.getElementById("result").className="invisible";document.getElementById("time").className="";document.getElementById("timeRemain").innerHTML=a.timeRemaining;document.getElementById("pYes").innerHTML="Yes: "+a.yesVotes;document.getElementById("pNo").innerHTML="No: "+a.noVotes;document.getElementById("pTotal").innerHTML="Total Possible: "+
a.total;!1===client.currentlyVoting&&(document.getElementById("voteButtons").className="invisible")});socket.on("send clear vote result",function(a){document.getElementById("result").className="";document.getElementById("time").className="invisible";document.getElementById("resultData").innerHTML=a});socket.on("cannot start vote",function(a){document.getElementById("voteButtons").className="";alert("Cannot vote to clear for another: "+a+" seconds.")});
socket.on("unlock canvas",function(a){client.currentlyVoting=!1;document.getElementById("clear-wrap").className="invisible";document.getElementById("voteButtons").className=""});socket.on("sync chat message",function(a){addChatMessage(a);a=document.getElementById("users-chat-tab");"tab selected"!=a.className?(client.messageCounter++,a.innerHTML='<a>Chat</a><div class="orange-notification">'+client.messageCounter+"</div>"):client.messageCounter=0});
socket.on("canvas saved",function(a){cSavedTimer=(new Date).getTime();document.getElementById("save-complete").className="";document.getElementById("save-progress").className="invisible";setTimeout(function(){document.getElementById("save-wrap").className="invisible";document.getElementById("save-complete").className="invisible";document.getElementById("save-progress").className="";client.currentlySaving=!1},1500)});socket.on("room does not exist",function(){location.reload()});
function clearChatNotifs(){client.messageCounter=0;document.getElementById("users-chat-tab").innerHTML="<a>Chat</a>"}function clearUserCounter(){client.userJoinCounter=0;document.getElementById("users-online-tab").innerHTML="<a>Users Online</a>"}
function addChatMessage(a){var b=document.getElementById("chat-box"),c=a.name;a.name===name&&(c="You");b.innerHTML+='<div class="chat-row"><div class="name" style="font-weight: bold;">'+c+': </div><div class="message"><p>'+a.message+"</p></div></div>";b.scrollTop=b.scrollHeight}function clearVote(a){socket.emit("receive clear vote",a);document.getElementById("voteButtons").className="invisible"}
function clearCanvas(){socket.emit("vote clear");document.getElementById("voteButtons").className="invisible"}function distanceBetween(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}function angleBetween(a,b){return Math.atan2(b.x-a.x,b.y-a.y)}var myEvent=window.attachEvent||window.addEventListener,chkevent=window.attachEvent?"onbeforeunload":"beforeunload";
myEvent(chkevent,function(a){a={name:name,colour:tool.brush.colour};1>=getConnectedUsers()?(a.canvas=canvas.toDataURL(),socket.emit("im offline store canvas",a)):socket.emit("im offline",a)});function saveRoom(){if(!0===client.hasSynced){client.currentlySaving=!0;document.getElementById("save-wrap").className="table-visible";document.getElementById("save-progress").className="";var a={canvas:canvas.toDataURL()};socket.emit("store canvas",a)}}
function clearUsers(){document.getElementById("users").innerHTML=""}function addUser(a,b){var c=document.getElementById("users");c.innerHTML+='<div id="'+a+'"class="row"><div class="user-colour" style="background-color: '+b+'"></div><div class="user-name">'+a+"</div></div>"}function getRandomColor(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b}document.getElementById("brushSelection").addEventListener("input",function(a){tool.brush.setBrushSize(this.value)});
speedSelection.addEventListener("input",function(a){tool.brush.rainbowSpeed=parseInt(this.value);tool.brush.gradientSpeed=parseInt(this.value)});var textSizeSel=document.getElementById("textSizeSel");textSizeSel.addEventListener("input",function(a){tool.textTool.changeTextSize(this.value)});function changeLineTip(){var a=document.getElementById("lineTip");tool.brush.lineTip=a.options[a.selectedIndex].value}
function applyText(){if(!0===tool.textTool.ready){var a=canvas.getBoundingClientRect(),a={x:tool.textTool.textPos.x-a.left,y:tool.textTool.textPos.y-a.top,font:tool.textTool.textFont,colour:tool.brush.colour,text:tool.textTool.textToRender};socket.emit("draw text",a);tool.textTool.drawText(a.x,a.y,tool.textTool.textFont,a.colour,tool.textTool.textToRender);tool.textTool.textToRender="";document.getElementById("text-tool-text").value="";tool.textTool.drawTempText(tool.textTool.textPos.x,tool.textTool.textPos.y,
tool.textTool.textFont,a.colour,tool.textTool.textToRender);tool.textTool.ready=!1;document.getElementById("text-tool-text").blur()}}
document.addEventListener("mousemove",function(a){Input.lastPos=Input.mousePos;Input.mousePos=Input.getMousePos(a);switch(tool.getBrushType()){case ToolTypes.FREE_ROAM:case ToolTypes.GRADIENT_BRUSH:case ToolTypes.RAINBOW_BRUSH:tool.brush.drawBrushOutline(Input.mousePos.x,Input.mousePos.y);break;case ToolTypes.TEXT_TOOL:tool.textTool.drawTempText(tool.textTool.textPos.x,tool.textTool.textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender);break;case ToolTypes.ERASER:case ToolTypes.SQUARE_BRUSH:tool.brush.drawEraserOutline(Input.mousePos.x,
Input.mousePos.y)}if(!0===Input.mouseDown&&!0===client.hasSynced&&!0===client.canDraw&&!1===client.currentlyVoting&&!1===client.currentlySaving)switch(tool.getBrushType()){case ToolTypes.FREE_ROAM:tool.brush.draw();break;case ToolTypes.GRADIENT_BRUSH:tool.updateGradientBrush();tool.brush.gradientDraw();break;case ToolTypes.RAINBOW_BRUSH:tool.updateRainbowBrush();tool.brush.rainbowDraw();break;case ToolTypes.DROPPER:tool.dropper.updateColour();break;case ToolTypes.ERASER:tool.brush.erase();break;case ToolTypes.SQUARE_BRUSH:tool.brush.drawSquare();
break;case ToolTypes.TEXT_TOOL:tool.textTool.textPos=Input.mousePos;break;case ToolTypes.SHAPE_TOOL:!0===tool.shapeTool.readyToDraw&&(tool.shapeTool.sizingReady=!0,tool.shapeTool.shapeEndPos=Input.mousePos,tool.shapeTool.drawTemp());break;case ToolTypes.LINE_TOOL:!0===tool.shapeTool.readyToDraw&&(tool.shapeTool.sizingReady=!0,tool.shapeTool.shapeEndPos=Input.mousePos,tool.brush.drawTempLine(tool.shapeTool.shapePos.x,tool.shapeTool.shapePos.y,tool.shapeTool.shapeEndPos.x,tool.shapeTool.shapeEndPos.y,
tool.brush.colour,tool.brush.size,tool.brush.lineTip))}else!0===client.hasSynced&&ColourPicker.changeColour()},!1);
document.addEventListener("mousedown",function(a){canvas.className="dragged";if(0===a.button&&(Input.mouseDown=!0,!0===Input.mouseDown&&!0===client.hasSynced&&!1===client.currentlyVoting&&!1===client.currentlySaving&&(!1===ColourPicker.canMoveTintPointer&&(Util.isMouseOnCanvas(ColourPicker.getTintContext().canvas)?(ColourPicker.canMoveTintPointer=!0,client.canDraw=!1):Util.isMouseOnCanvas(ColourPicker.getHueContext().canvas)&&(ColourPicker.canMoveHuePointer=!0,client.canDraw=!1)),!1===client.canDraw&&
Util.isMouseOnCanvas(canvas)&&(client.canDraw=!0),ColourPicker.changeColour(),!0===client.canDraw)))switch(tool.getBrushType()){case ToolTypes.FREE_ROAM:tool.brush.draw();break;case ToolTypes.GRADIENT_BRUSH:tool.brush.gradientTimer=0;tool.brush.gradientDraw();break;case ToolTypes.RAINBOW_BRUSH:tool.brush.rainbowDraw();break;case ToolTypes.DROPPER:tool.dropper.updateColour();break;case ToolTypes.ERASER:tool.brush.erase();break;case ToolTypes.SQUARE_BRUSH:tool.brush.drawSquare();break;case ToolTypes.TEXT_TOOL:tool.textTool.ready=
!0;tool.textTool.textPos=Input.mousePos;break;case ToolTypes.SHAPE_TOOL:case ToolTypes.LINE_TOOL:!1===tool.shapeTool.readyToDraw&&(tool.shapeTool.readyToDraw=!0,tool.shapeTool.shapePos=Input.mousePos)}});
document.addEventListener("mouseup",function(a){canvas.className="";if(0===a.button){Input.mouseDown=!1;if(!0===tool.shapeTool.sizingReady&&!1===client.currentlyVoting&&!1===client.currentlySaving){pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height);a=canvas.getBoundingClientRect();switch(tool.getBrushType()){case ToolTypes.SHAPE_TOOL:a={x:tool.shapeTool.shapePos.x-a.left,y:tool.shapeTool.shapePos.y-a.top,endX:tool.shapeTool.shapeEndPos.x-a.left,endY:tool.shapeTool.shapeEndPos.y-
a.top,colour:tool.brush.colour};!0===tool.shapeTool.readyToDraw&&tool.shapeTool.draw(a);break;case ToolTypes.LINE_TOOL:a={x:tool.shapeTool.shapePos.x-a.left,y:tool.shapeTool.shapePos.y-a.top,endX:tool.shapeTool.shapeEndPos.x-a.left,endY:tool.shapeTool.shapeEndPos.y-a.top,lineTip:tool.brush.lineTip,size:tool.brush.size,colour:tool.brush.colour},tool.brush.drawShapeLine(a.x,a.y,a.endX,a.endY,a.colour,a.size,a.lineTip),socket.emit("draw line",a),tool.shapeTool.sizingReady=!1}tool.shapeTool.readyToDraw=
!1}tool.shapeTool.readyToDraw=!1;!0===ColourPicker.canMoveTintPointer&&(ColourPicker.canMoveTintPointer=!1);!0===ColourPicker.canMoveHuePointer&&(ColourPicker.canMoveHuePointer=!1);!0===client.canDraw&&(client.canDraw=!1)}});
document.body.addEventListener("keydown",function(a){!0===tool.textTool.ready&&!1===client.currentlyVoting&&!1===client.currentlySaving&&(tool.textTool.textToRender=document.getElementById("text-tool-text").value,tool.textTool.drawTempText(tool.textTool.textPos.x,tool.textTool.textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender),document.getElementById("text-tool-text").focus(),13==a.keyCode&&applyText())});
document.body.addEventListener("keyup",function(a){!0===tool.textTool.ready&&!1===client.currentlyVoting&&!1===client.currentlySaving&&(tool.textTool.textToRender=document.getElementById("text-tool-text").value,tool.textTool.drawTempText(tool.textTool.textPos.x,tool.textTool.textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender))});document.getElementById("fontSel").addEventListener("change",function(a){tool.textTool.changeFont()});
document.getElementById("clearCanvas").addEventListener("click",function(a){clearCanvas()});
document.getElementById("brushes").addEventListener("click",function(a){tool.brush.setBrushType("freeroam");resetCategoryFlags();resetSubCategoryFlags();this.className="button bselect tool";document.getElementById("brush-settings").className="inline-block";document.getElementById("brush").className="button bselect tool";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("brush").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("freeroam");this.className="button bselect tool";document.getElementById("brush-settings").className="inline-block";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("square-brush").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("square-brush");this.className="button bselect tool";document.getElementById("brush-settings").className="inline-block";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("gradient-brush").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("gradient-brush");this.className="button bselect tool";document.getElementById("brush-settings").className="";document.getElementById("rainbow-settings").className="inline-block";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("rainbow-brush").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("rainbow-brush");this.className="button bselect tool";document.getElementById("brush-settings").className="";document.getElementById("rainbow-settings").className="inline-block";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("line-tool").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("line");this.className="button bselect tool";document.getElementById("canvas").style.cursor="pointer";document.getElementById("pointer-canvas").style.cursor="pointer";document.getElementById("brush-settings").className="";document.getElementById("line-settings").className="inline-block"});
document.getElementById("eraser").addEventListener("click",function(a){resetSubCategoryFlags();tool.brush.setBrushType("eraser");this.className="button bselect tool";document.getElementById("brush-settings").className="";document.getElementById("canvas").style.cursor="none";document.getElementById("pointer-canvas").style.cursor="none"});
document.getElementById("shape-tool").addEventListener("click",function(a){resetCategoryFlags();resetSubCategoryFlags();tool.brush.setBrushType("shape");tool.shapeTool.setShapeType(document.getElementById("shapeRect"),"rectangle");this.className="button bselect tool";document.getElementById("canvas").style.cursor="pointer";document.getElementById("pointer-canvas").style.cursor="pointer";document.getElementById("shape-settings").className=""});
document.getElementById("shapeRect").addEventListener("click",function(a){resetSubCategoryFlags();tool.shapeTool.setShapeType(this,"rectangle");document.getElementById("shape-settings").className="inline-block"});document.getElementById("shapeCircle").addEventListener("click",function(a){resetSubCategoryFlags();tool.shapeTool.setShapeType(this,"circle");document.getElementById("shape-settings").className="inline-block"});
document.getElementById("shapePentagon").addEventListener("click",function(a){resetSubCategoryFlags();tool.shapeTool.setShapeType(this,"pentagon");document.getElementById("shape-settings").className="inline-block"});document.getElementById("shapeHexagon").addEventListener("click",function(a){resetSubCategoryFlags();tool.shapeTool.setShapeType(this,"hexagon");document.getElementById("shape-settings").className="inline-block"});
document.getElementById("text-tool").addEventListener("click",function(a){resetCategoryFlags();resetSubCategoryFlags();tool.brush.setBrushType("text");this.className="button bselect tool";document.getElementById("canvas").style.cursor="text";document.getElementById("pointer-canvas").style.cursor="text";document.getElementById("text-settings").className=""});
document.getElementById("colourDrop").addEventListener("click",function(a){tool.brush.setBrushType("dropper");resetCategoryFlags();resetSubCategoryFlags();this.className="button bselect tool";document.getElementById("pointer-canvas").style.cursor="crosshair";document.getElementById("dropper-settings").className=""});document.getElementById("saveCanvas").addEventListener("click",function(a){window.open(canvas.toDataURL())});
function resetCategoryFlags(){tool.textTool.textToRender="";tool.textTool.ready=!1;document.getElementById("brushes").className="button tool";document.getElementById("colourDrop").className="button tool";document.getElementById("text-tool").className="button tool";document.getElementById("shape-tool").className="button tool";pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height)}
function resetSubCategoryFlags(){document.getElementById("brush").className="button tool";document.getElementById("square-brush").className="button tool";document.getElementById("gradient-brush").className="button tool";document.getElementById("rainbow-brush").className="button tool";document.getElementById("line-tool").className="button tool";document.getElementById("eraser").className="button tool";document.getElementById("shapeRect").className="button tool";document.getElementById("shapeCircle").className=
"button tool";document.getElementById("shapePentagon").className="button tool";document.getElementById("shapeHexagon").className="button tool";document.getElementById("brush-settings").className="invisible";document.getElementById("rainbow-settings").className="invisible";document.getElementById("dropper-settings").className="invisible";document.getElementById("text-settings").className="invisible";document.getElementById("shape-settings").className="invisible";document.getElementById("line-settings").className=
"invisible";pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height)};function fillBucket(a,b){for(var c=hexToRgb(b),d=getColourOnCanvas(canvas,context),e=a.getImageData(0,0,canvas.width,canvas.height),f=0;f<e.data.length-4;f+=4)e.data[f]==d.r&&e.data[f+1]==d.g&&e.data[f+2]==d.b&&e.data[f+3]==d.a&&(e.data[f]=c.r,e.data[f+1]=c.g,e.data[f+2]=c.b,e.data[f+3]=255);context.putImageData(e,0,0);socket.emit("canvas update",canvas.toDataURL())}
function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};var Colour=function(a,b,c){this.r=a;this.g=b;this.b=c},Position=function(a,b){this.x=a;this.y=b},ColourPicker={tintPosition:new Position(0,0),huePosition:new Position(0,0),canMoveTintPointer:!1,canMoveHuePointer:!1,colourTimer:(new Date).getTime(),tintImage:new Image};ColourPicker.tintImage.src="/images/tint.png";ColourPicker.tintImage.onload=function(){ColourPicker.createTint(ColourPicker.getTintContext(),new Colour(255,0,0))};
ColourPicker.initColourPicker=function(){document.getElementById("colour-picker").style.cursor="crosshair";this.createTint(this.getTintContext(),new Colour(255,0,0));this.createHue(this.getHueContext());this.drawTintPointer(this.getTintPointerContext(),new Position(0,0))};ColourPicker.createTint=function(a,b){a.fillStyle=Util.rgbToHex(b);a.fillRect(0,0,256,256);a.fillStyle=Util.rgbToHex(b);a.drawImage(this.tintImage,0,0)};
ColourPicker.createHue=function(a){for(var b=0;b<=a.canvas.width;b++)for(var c=0;255>=c;c++)a.fillStyle=Util.rgbToHex(Util.hsvToRgb(1-c/256,1,1)),a.fillRect(b,c,b+1,c+1)};
ColourPicker.changeColour=function(){if(this.canMoveHuePointer){var a=this.getHueContext().canvas.getBoundingClientRect();this.huePosition=new Position(Input.mousePos.x-a.left,Input.mousePos.y-a.top);this.enforceHueBounds(this.huePosition);this.createTint(this.getTintContext(),this.getColourOnHueCanvas(this.getHueContext(),this.huePosition));this.getHueArrows()[0].style.top=this.huePosition.y-7;this.getHueArrows()[1].style.top=this.huePosition.y-7;a=document.getElementById("currentColour");a.style.backgroundColor=
Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition));tool.brush.setColour(Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition)))}this.canMoveTintPointer&&(a=this.getTintContext().canvas.getBoundingClientRect(),this.tintPosition=new Position(Input.mousePos.x-a.left,Input.mousePos.y-a.top),this.enforceTintBounds(this.tintPosition),this.drawTintPointer(this.getTintPointerContext(),this.tintPosition),a=document.getElementById("currentColour"),
a.style.backgroundColor=Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition)),tool.brush.setColour(Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition))));(new Date).getTime()>this.colourTimer+200&&(this.colourTimer=(new Date).getTime(),socket.emit("update colour",tool.brush.colour))};
ColourPicker.updateColour=function(){document.getElementById("currentColour").style.backgroundColor=Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition));tool.brush.setColour(Util.rgbToHex(this.getColourOnTintCanvas(this.getTintContext(),this.tintPosition)));this.getHueArrows()[0].style.top=this.huePosition.y-7;this.getHueArrows()[1].style.top=this.huePosition.y-7;this.createTint(this.getTintContext(),this.getColourOnHueCanvas(this.getHueContext(),this.huePosition));this.drawTintPointer(this.getTintPointerContext(),
this.tintPosition);(new Date).getTime()>this.colourTimer+200&&(this.colourTimer=(new Date).getTime(),socket.emit("update colour",tool.brush.colour))};ColourPicker.getTintContext=function(){return document.getElementById("tint").getContext("2d")};ColourPicker.getHueContext=function(){return document.getElementById("hue").getContext("2d")};ColourPicker.getTintPointerContext=function(){return document.getElementById("tint-pointer").getContext("2d")};
ColourPicker.getHueArrows=function(){return[document.getElementById("hue-arrow-left"),document.getElementById("hue-arrow-right")]};ColourPicker.drawTintPointer=function(a,b){a.clearRect(0,0,a.canvas.width,a.canvas.width);a.beginPath();a.strokeStyle="white";a.arc(b.x,b.y,5,0,2*Math.PI);a.stroke();a.beginPath();a.strokeStyle="black";a.arc(b.x,b.y,6,0,2*Math.PI);a.stroke();a.beginPath();a.strokeStyle="white";a.arc(b.x,b.y,7,0,2*Math.PI);a.stroke()};
ColourPicker.getColourOnTintCanvas=function(a,b){var c=b.x,d=b.y;255<=c&&(c=255);255<=d&&(d=255);c=a.getImageData(c,d,1,1).data;return new Colour(c[0],c[1],c[2])};ColourPicker.getColourOnHueCanvas=function(a,b){var c=b.y;255<=c&&(c=255);c=a.getImageData(0,c,1,c+1).data;return new Colour(c[0],c[1],c[2])};ColourPicker.getColourOnCanvas=function(a,b){var c=a.getBoundingClientRect(),c=b.getImageData(Input.mousePos.x-c.left,Input.mousePos.y-c.top,1,1).data;return{r:c[0],g:c[1],b:c[2],a:c[3]}};
ColourPicker.enforceTintBounds=function(a){var b=this.getTintContext().canvas.getBoundingClientRect(),c=Input.mousePos;c.x<b.left&&c.y<b.top?(a.x=0,a.y=0):c.x>=b.right&&c.y<b.top?(a.x=255,a.y=0):c.x>=b.right&&c.y>=b.bottom?(a.x=255,a.y=255):c.x<b.left&&c.y>=b.bottom?(a.x=0,a.y=255):c.x<b.left?(a.x=0,a.y=c.y-b.top):c.x>=b.right?(a.x=255,a.y=c.y-b.top):c.y<b.top?(a.x=c.x-b.left,a.y=0):c.y>=b.bottom&&(a.x=c.x-b.left,a.y=255)};
ColourPicker.enforceHueBounds=function(a){var b=this.getHueContext().canvas.getBoundingClientRect(),c=Input.mousePos;c.x<b.left&&c.y<b.top||c.x>=b.right&&c.y<b.top?(a.x=0,a.y=0):c.x>=b.right&&c.y>=b.bottom||c.x<b.left&&c.y>=b.bottom?(a.x=0,a.y=256):c.x<b.left||c.x>=b.right?(a.x=0,a.y=c.y-b.top):c.y<b.top?(a.x=c.x-b.left,a.y=0):c.y>=b.bottom&&(a.x=c.x-b.left,a.y=256)};var usersOnlineTab=document.getElementById("users-online-tab"),usersChatTab=document.getElementById("users-chat-tab");usersOnlineTab.onclick=function(){usersOnlineTab.className="tab selected";usersChatTab.className="tab";document.getElementById("users-online").className="visible";document.getElementById("users-chat").className="invisible";clearUserCounter()};
usersChatTab.onclick=function(){usersChatTab.className="tab selected";usersOnlineTab.className="tab";document.getElementById("users-chat").className="visible";document.getElementById("users-online").className="invisible";clearChatNotifs()};window.changeLineTip=changeLineTip;window.sendChatMessage=sendChatMessage;window.clearVote=clearVote;window.init=init;window.loadCanvasPage=loadCanvasPage;window.sync=sync;window.applyText=applyText;window.saveRoom=saveRoom;window.selectElement=selectElement;window.selectACPElement=selectACPElement;window.redirectToRoom=redirectToRoom;window.searchRoom=searchRoom;window.joinRoom=joinRoom;
